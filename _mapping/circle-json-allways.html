list themes list recs list texts while linking to themes and recs and genres (and building genre list)

<!-- AirTable -->
<script src="../js/airtable.browser.js"></script>
<!-- <script src="js/app.js"></script> -->
<script>
	var nodes = [];
	var nodesjson = [];
	let thing3 = [];
	var links = [];
	var genres = [];
	var Airtable = require("airtable");
	var base = new Airtable({ apiKey: "pattA7nyQpqdRuVkV.5da2261a64ad65d025c024cd1c6a9d35fe1fb299738eab1f73ab9c412da94c91" }).base("appBKn1E7gk7Kakkj");

	function toploop() {}
	function subloop() {}
	//
	base("Principles")
		.select({
			maxRecords: 3,
			view: "Grid view",
			// filterByFormula: "{DisplayOnWeb} = TRUE()",
			fields: ["Title"],
		})
		.eachPage(
			function page(records, fetchNextPage) {
				// This function (`page`) will get called for each page of records.
				records.forEach(function (record) {
					let thing1 = { name: "root.Principles." + record.fields["Title"].replaceAll(" ", "_"), imports: [] };
					nodesjson.push(thing1);
				});

				fetchNextPage();
			},
			function done(err) {
				if (err) {
					console.error(err);
					return;
				}
			}
		);
	//
	base("Design Recommendations")
		.select({
			maxRecords: 3,
			view: "Grid view",
			// filterByFormula: "{DisplayOnWeb} = TRUE()",
			fields: ["Title"],
		})
		.eachPage(
			function page(records, fetchNextPage) {
				// This function (`page`) will get called for each page of records.
				records.forEach(function (record) {
					let thing1 = { name: "root.Recommendations." + record.fields["Title"].replaceAll(" ", "_"), imports: [] };
					nodesjson.push(thing1);
				});

				fetchNextPage();
			},
			function done(err) {
				if (err) {
					console.error(err);
					return;
				}
			}
		);
	//
	base("Cultural Texts")
		.select({
			maxRecords: 3,
			view: "Grid view",
			// filterByFormula: "{DisplayOnWeb} = TRUE()",
			fields: ["Title", "Principles (Web)", "Design Recommendations (Web)", "Genre"],
		})
		.eachPage(
			function page(records, fetchNextPage) {
				// This function (`page`) will get called for each page of records.
				records.forEach(function (record) {
					let thing1 = { name: "root.Texts." + record.fields["Title"].replaceAll(" ", "_"), imports: [] };
					//
					let thing2 = [];
					let thing4 = [];
					if (typeof record.fields["Genre"] !== "undefined") {
						let jonjon = record.fields["Genre"];
						if (genres.includes(jonjon) === false) {
							let thing4 = { name: "root.Genres." + jonjon.replaceAll(" ", "_"), imports: [] };
							nodesjson.push(thing4);
						}
						thing2.push("root.Genres." + jonjon.replaceAll(" ", "_"));
					}
					//
					if (typeof record.fields["Principles (Web)"] !== "undefined") {
						let prin = record.fields["Principles (Web)"];
						prin.forEach(function (p) {
							thing2.push("root.Principles." + p.replaceAll(" ", "_"));
						});
					}
					//
					if (typeof record.fields["Design Recommendations (Web)"] !== "undefined") {
						let recs = record.fields["Design Recommendations (Web)"];
						recs.forEach(function (r) {
							thing2.push("root.Recommendations." + r.replaceAll(" ", "_"));
						});
					}
					//
					nodesjson.push(thing1);
				});

				fetchNextPage();
			},
			function done(err) {
				if (err) {
					console.error(err);
					return;
				} else {
					console.log(nodesjson);
					console.log(JSON.stringify(nodesjson));
				}
			}
		);
</script>
